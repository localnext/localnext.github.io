on:
push:
branches:
- main
pull_request:
workflow_dispatch:
permissions:
contents: write
jobs:
update-lockfile:
runs-on: ubuntu-latest
steps:
- name: Checkout repository
uses: actions/checkout@v4
with:
# This token is required to allow the action to push to the repository
token: ${{ secrets.GITHUB_TOKEN }}
  - name: Setup Bun
    uses: oven-sh/setup-bun@v2
    with:
      bun-version: latest

  - name: Install dependencies and update lockfile
    run: bun install

  - name: Commit and push changes
    run: |
      if [ -n "$(git status --porcelain bun.lockb)" ]; then
        echo "Changes detected in bun.lockb. Committing and pushing..."
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"
        git add bun.lockb
        git commit -m "chore: Auto-update bun.lockb"
        git push
      else
        echo "No changes in bun.lockb. Skipping commit."
      fi
